import tallerpoo.archivos.SistemaGestion;
import tallerpoo.clases.Carrera;
import tallerpoo.clases.ResultadoCarrera;
import tallerpoo.clases.Piloto;
import tallerpoo.clases.Puntaje;
import java.util.List;
import java.util.ArrayList;
import java.util.Collections;
import java.util.Comparator;

public class LogicaInformes{
    
    /**
     * Método ayudante privado para convertir fechas de "dd-MM-yyyy" a "yyyy-MM-dd".
     * Esto permite que se puedan comparar alfabéticamente de forma correcta.
     */
    private String formatearFecha(String fechaDDMMAAAA) {
        // Asumiendo formato "dd-MM-yyyy"
        try {
            String[] partes = fechaDDMMAAAA.split("-");
            if (partes.length == 3) {
                return partes[2] + "-" + partes[1] + "-" + partes[0];
            }
            return fechaDDMMAAAA; // Devuelve original si el formato falla
        } catch (Exception e) {
            return fechaDDMMAAAA; // Devuelve original en caso de error
        }
    }

    /**
     * Obtiene una lista detallada de resultados de carreras dentro de un rango de fechas.
     *
     * @param datos El objeto SistemaGestion que contiene todos los datos.
     * @param fechaDesde La fecha de inicio del rango (formato "dd-MM-yyyy").
     * @param fechaHasta La fecha de fin del rango (formato "dd-MM-yyyy").
     * @return Una lista de ResultadoCarrera, ordenada por fecha y luego por posición.
     */
    public List<ResultadoCarrera> getReporteResultadosPorFechas(SistemaGestion datos, String fechaDesde, String fechaHasta) {
        
        List<ResultadoCarrera> resultadosEnRango = new ArrayList<>();
        
        //Convertimos las fechas del rango a un formato comparable (YYYY-MM-DD)
        String fechaDesdeFormateada = formatearFecha(fechaDesde);
        String fechaHastaFormateada = formatearFecha(fechaHasta);

        //Iteramos sobre todos los resultados guardados en el sistema
        for (ResultadoCarrera resultado : datos.getResultadosCarreras()) {
            
            //Obtenemos la fecha de la carrera de ese resultado
            Carrera carreraDelResultado = resultado.getCarrera();
            String fechaCarrera = carreraDelResultado.getFechaRealizacion();
            String fechaCarreraFormateada = formatearFecha(fechaCarrera);

            //Comparamos las fechas (como Strings YYYY-MM-DD)
            boolean estaDespuesDeInicio = fechaCarreraFormateada.compareTo(fechaDesdeFormateada) >= 0;
            boolean estaAntesDeFin = fechaCarreraFormateada.compareTo(fechaHastaFormateada) <= 0;

            if (estaDespuesDeInicio && estaAntesDeFin) {
                // Si la carrera está en el rango, añadimos su resultado a la lista
                resultadosEnRango.add(resultado);
            }
        }

        // Ordenamos la lista para que sea legible:
        // Primero por fecha de carrera, y luego por posición (1°, 2°, 3°...)
        Collections.sort(resultadosEnRango, new Comparator<ResultadoCarrera>() {
            @Override
            public int compare(ResultadoCarrera r1, ResultadoCarrera r2) {
                // Comparamos por fecha primero
                String fecha1 = formatearFecha(r1.getCarrera().getFechaRealizacion());
                String fecha2 = formatearFecha(r2.getCarrera().getFechaRealizacion());
                
                int comparacionFecha = fecha1.compareTo(fecha2);
                
                if (comparacionFecha != 0) {
                    // Si las fechas son distintas, ordena por fecha
                    return comparacionFecha;
                } else {
                    // Si las fechas son iguales, ordena por posición
                    return Integer.compare(r1.getPosicion(), r2.getPosicion());
                }
            }
        });

        return resultadosEnRango;
    }
    
<<<<<<< HEAD
    /**
     * REQUISITO 2: Devuelve el ranking de pilotos ordenado.
     * Llama a LogicaGestion para calcular y luego este método ordena.
     *
     * @param datos El objeto SistemaGestion (para los datos).
     * @param logicaGestion El objeto LogicaGestion (para el cálculo).
     * @return Una lista de PilotoPuntaje ORDENADA.
     */
    public List<PilotoPuntaje> getRankingPilotos(SistemaGestion datos, LogicaGestion logicaGestion) {
        
        // 1. Llama al método de LogicaGestion para "Calcular"
        List<PilotoPuntaje> puntajesSinOrdenar = logicaGestion.calcularPuntajes(datos);

        // 2. Este método se encarga de "Rankear" (Ordenar)
        // Usa el compareTo que definiste en PilotoPuntaje
        Collections.sort(puntajesSinOrdenar);

        // 3. Devuelve la lista ordenada
        return puntajesSinOrdenar;
    }


=======


    /**Calcula la cantidad de veces que un piloto específico corrió en un circuito determinado.
     * (Versión alternativa recorriendo todas las carreras del sistema).
     *
     * @param datos El objeto SistemaGestion que contiene la lista de todas las carreras.
     * @param pilotoBuscado El piloto a consultar.
     * @param circuitoBuscado El circuito a consultar.
     * @return El número de carreras (int) que el piloto corrió en ese circuito.
     */
    public int getContadorPilotoEnCircuito(SistemaGestion datos, Piloto pilotoBuscado, Circuito circuitoBuscado) {
        
        int contador = 0;

        //Obtenemos la lista de todas las carreras del sistema
        List<Carrera> todasLasCarreras = datos.getCarreras();

        //Recorremos cada carrera, una por una
        for (Carrera carrera : todasLasCarreras) {
            
            //Verificamos si esta carrera es en el circuito que buscamos
            if (carrera.getCircuito() != null && carrera.getCircuito().equals(circuitoBuscado)) {
                
                //Si es en el circuito correcto, revisamos los participantes
                List<AutoPiloto> participantesDeLaCarrera = carrera.getParticipantes();
                
                for (AutoPiloto participante : participantesDeLaCarrera) {
                    
                    //Verificamos si el piloto que buscamos está en esa lista
                    if (participante.getPiloto() != null && participante.getPiloto().equals(pilotoBuscado)) {
                        
                        //Coincide, sumamos 1
                        contador++;
                        
                        // Como un piloto solo corre una vez por carrera, dejamos de buscar en esta carrera y vamos a la siguiente.
                        break;
                    }
                }
            }
        }
        
        //Devolvemos el total
        return contador;
    }
>>>>>>> 814fcd53a63a4b07384f1f9d43088adb5ec6d747
}